# 股票智能分析助手项目开发思路

## 一、项目目标

本项目旨在构建一个支持多种股票智能分析能力的交互式助手，面向终端和Web用户，提供如下核心功能：

- 历史行情查询
- ARIMA模型预测未来股价
- Prophet周期性分析
- BOLL（布林带）异常检测
- 图表自动生成与可视化
- FAQ知识库辅助问答

---

## 二、整体架构

1. **主程序**：`assistant_stock_bot.py`
   - 集成所有核心功能，负责用户交互、SQL查询、数据分析、可视化、Web界面等。
   - 支持终端模式（TUI）和Web模式（GUI）。

2. **数据层**：
   - **数据库表结构**：`stock_history_table.sql`、`数据字段说明.md`
     - 统一的 `stocks_history` 表，存储所有股票的历史数据，字段详尽，支持高效查询。
   - **本地样本数据**：`stock_history-2.csv`、`stock_history.xlsx`
     - 用于测试和演示。

3. **数据采集与处理**：
   - **数据抓取脚本**：`fetch_stock_history.py`
     - 使用 Tushare 接口，批量抓取指定股票的历史行情，合并为统一格式。
   - **数据清洗脚本**：`convert_and_sort_stock_history.py`
     - 对原始数据进行格式转换、排序等预处理。

4. **知识库与辅助**：
   - **FAQ知识库**：`faq.txt`
     - 常见问题与分析方法，辅助LLM生成更专业的回答。

5. **可视化与输出**：
   - **图片目录**：`image_show/`
     - 自动生成的分析图表，供Web端展示。

6. **依赖管理**：
   - **依赖清单**：`requirements.txt`
     - 统一管理所有Python依赖包，便于环境部署。

---

## 三、主要功能实现思路

### 1. 历史行情查询

- 用户可通过股票名称或代码查询历史行情。
- 支持SQL自动生成，默认查询最近30天数据，结果自动可视化（表格+图表）。

### 2. ARIMA预测

- 输入股票代码和预测天数，自动提取最近一年历史数据，构建ARIMA模型，预测未来N天收盘价。
- 结果以表格和折线图形式展示。

### 3. Prophet周期分析

- 输入股票代码和时间范围，使用Prophet模型分解收盘价的趋势、周、年成分。
- 输出趋势分解图和结构化表格。

### 4. BOLL异常检测

- 输入股票代码和时间范围，计算20日布林带，检测超买/超卖点。
- 结果以表格和图形标注展示。

### 5. FAQ知识库与智能问答

- 内置FAQ知识库，辅助LLM理解常见分析场景和SQL生成规范。
- 支持自然语言对话，自动识别股票名称、时间范围、分析类型。

---

## 四、开发流程建议

1. **环境准备**：安装依赖，配置数据库和API Key。
2. **数据采集**：运行数据抓取脚本，准备本地测试数据。
3. **数据库初始化**：执行建表SQL，导入历史数据。
4. **主程序开发**：分模块实现SQL查询、ARIMA、Prophet、BOLL等功能，逐步集成。
5. **可视化优化**：完善图表生成逻辑，适配Web端展示。
6. **知识库完善**：补充FAQ，优化LLM提示词和交互体验。
7. **测试与部署**：本地测试各功能，完善异常处理，部署Web服务。

---

## 五、扩展与维护建议

- 支持更多分析模型（如LSTM、XGBoost等）。
- 增加多股票对比、板块分析等高级功能。
- 优化Web界面交互体验。
- 定期更新FAQ和数据采集脚本，保证数据时效性。

---